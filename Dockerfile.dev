# Development container
FROM node:20-alpine

# Enable corepack and install pnpm
RUN corepack enable && corepack prepare pnpm@latest --activate

# Install system dependencies for Playwright
RUN apk add --no-cache \
    chromium \
    nss \
    freetype \
    freetype-dev \
    harfbuzz \
    ca-certificates \
    ttf-freefont

# Set working directory
WORKDIR /workspace

# Copy package.json first for better caching
COPY package.json ./

# Install dependencies (no lock file needed)
RUN pnpm install

# Copy source code
COPY . .

# Set PATH to include node_modules/.bin
ENV PATH="/workspace/node_modules/.bin:$PATH"

# Expose Vite dev server port
EXPOSE 5173

# Default command (can be overridden)
CMD ["pnpm", "dev", "--host", "0.0.0.0"]
